version: '3'

services:
  # service_1:
  #   image: golang:latest
  #   container_name: service_1
  #   volumes:
  #     - ../cmd/first-service:/app
  #   working_dir: /app
  #   command: go run main.go
  #   # depends_on:
      # - postgres_1
      # - kafka

  # service_2:
  #   image: golang:latest
  #   container_name: golang_service_2
  #   volumes:
  #     - ./golang_service_2:/app
  #   working_dir: /app
  #   command: go run main.go
  #   depends_on:
  #     - postgres_2
  #     - kafka

  # service_3:
  #   image: golang:latest
  #   container_name: golang_service_3
  #   volumes:
  #     - ./golang_service_3:/app
  #   working_dir: /app
  #   command: go run main.go

  postgres_1:
    image: postgres:latest
    container_name: postgres_1
    volumes:
    - ./first-init.sql:/docker-entrypoint-initdb.d/init.sql
    env_file:
      - ./.env.first
    ports:
      - 5433:5432

  postgres_2:
    image: postgres:latest
    container_name: postgres_2
    volumes:
    - ./second-init.sql:/docker-entrypoint-initdb.d/init.sql
    env_file:
      - ./.env.second
    ports:
      - 5434:5432

  kafka:
    image: 'wurstmeister/kafka:latest'
    container_name: kafka
    environment:
      - KAFKA_LISTENERS=PLAINTEXT://:9092
      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092
      - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
      - ALLOW_PLAINTEXT_LISTENER=yes
    ports:
      - '9092:9092'
    depends_on:
      - zookeeper

  zookeeper:
    image: 'wurstmeister/zookeeper:latest'
    container_name: zookeeper
    environment:
      - ZOOKEEPER_CLIENT_PORT=2181
    ports:
      - "2181:2181"
